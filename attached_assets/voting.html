<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book Cover Voting</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(20px) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0) translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.5); }
      to { opacity: 1; transform: scale(1); }
    }

    .notification-show {
      animation: slideIn 0.3s ease forwards;
    }

    .notification-hide {
      animation: slideIn 0.3s ease reverse forwards;
    }

    .card-animate {
      animation: fadeIn 0.5s ease forwards;
    }

    .count-reveal {
      animation: scaleIn 0.3s ease forwards;
    }

    .vote-count {
      visibility: hidden;
    }

    .vote-count.revealed {
      visibility: visible;
    }

    .pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-b from-stone-50 to-stone-100">
  
  <!-- Header -->
  <header class="bg-white border-b border-stone-200">
    <div class="max-w-6xl mx-auto px-6 py-8">
      <div class="flex items-center justify-center gap-3 mb-4">
        <div class="p-2.5 bg-stone-900 rounded-xl">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
          </svg>
        </div>
        <h1 class="text-2xl md:text-3xl font-bold text-stone-900 tracking-tight">
          Book Cover Selection
        </h1>
      </div>
      <p class="text-center text-stone-600 max-w-xl mx-auto">
        Help us choose the perfect cover design. Your feedback is valuable in making this decision.
      </p>
    </div>
  </header>

  <!-- Stats Bar -->
  <div class="bg-white/50 border-b border-stone-200/50">
    <div class="max-w-6xl mx-auto px-6 py-4">
      <div class="flex items-center justify-center gap-8 text-sm">
        <div class="flex items-center gap-2 text-stone-600">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
          </svg>
          <span><strong class="text-stone-900" id="totalVoters">0</strong> participants</span>
        </div>
        <div class="flex items-center gap-2 text-stone-600">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
          </svg>
          <span><strong class="text-stone-900" id="totalVotes">0</strong> votes cast</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="max-w-6xl mx-auto px-6 py-12">
    <!-- Instructions -->
    <div class="bg-amber-50 border border-amber-200 rounded-xl p-5 mb-10">
      <h2 class="font-semibold text-amber-900 mb-2">How to Participate</h2>
      <ul class="text-sm text-amber-800 space-y-1">
        <li>‚Ä¢ Review each book cover design carefully</li>
        <li>‚Ä¢ Click üëç Like, ‚ûñ Neutral, or üëé Dislike for each cover</li>
        <li>‚Ä¢ Vote counts are revealed only after you submit your vote</li>
        <li>‚Ä¢ Each person can vote once per cover</li>
      </ul>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      <div class="bg-white rounded-2xl overflow-hidden">
        <div class="aspect-[3/4] bg-stone-200 pulse"></div>
        <div class="p-6 space-y-4">
          <div class="h-5 bg-stone-200 rounded w-2/3 mx-auto pulse"></div>
          <div class="h-4 bg-stone-100 rounded w-1/2 mx-auto pulse"></div>
          <div class="flex gap-2">
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-2xl overflow-hidden">
        <div class="aspect-[3/4] bg-stone-200 pulse"></div>
        <div class="p-6 space-y-4">
          <div class="h-5 bg-stone-200 rounded w-2/3 mx-auto pulse"></div>
          <div class="h-4 bg-stone-100 rounded w-1/2 mx-auto pulse"></div>
          <div class="flex gap-2">
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-2xl overflow-hidden">
        <div class="aspect-[3/4] bg-stone-200 pulse"></div>
        <div class="p-6 space-y-4">
          <div class="h-5 bg-stone-200 rounded w-2/3 mx-auto pulse"></div>
          <div class="h-4 bg-stone-100 rounded w-1/2 mx-auto pulse"></div>
          <div class="flex gap-2">
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-2xl overflow-hidden">
        <div class="aspect-[3/4] bg-stone-200 pulse"></div>
        <div class="p-6 space-y-4">
          <div class="h-5 bg-stone-200 rounded w-2/3 mx-auto pulse"></div>
          <div class="h-4 bg-stone-100 rounded w-1/2 mx-auto pulse"></div>
          <div class="flex gap-2">
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-2xl overflow-hidden">
        <div class="aspect-[3/4] bg-stone-200 pulse"></div>
        <div class="p-6 space-y-4">
          <div class="h-5 bg-stone-200 rounded w-2/3 mx-auto pulse"></div>
          <div class="h-4 bg-stone-100 rounded w-1/2 mx-auto pulse"></div>
          <div class="flex gap-2">
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
            <div class="flex-1 h-20 bg-stone-100 rounded-xl pulse"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cover Grid -->
    <div id="coversGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 hidden"></div>
  </main>

  <!-- Footer -->
  <footer class="border-t border-stone-200 bg-white/50 mt-auto">
    <div class="max-w-6xl mx-auto px-6 py-6 text-center">
      <p class="text-sm text-stone-500">
        Thank you for participating in this cover selection process.
      </p>
    </div>
  </footer>

  <!-- Notification -->
  <div id="notification" class="fixed top-6 right-6 z-50 hidden"></div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwqDRg5Gs-9xUakpqCyv2OD-bfYkU4SJRMjDE3qJolNIjfEvdzwBKv-4n-9UoPoqYhaIw/exec';
    let scriptCounter = 0;

    const BOOK_COVERS = [
      {
        id: 'Cover 1',
        name: 'Cover 1',
        subtitle: 'Design Option A',
        image: 'https://raw.githubusercontent.com/SoLuutions/Clark-Lindley-Suan/refs/heads/main/attached_assets/cover%20(1).png'
      },
      {
        id: 'Cover 2',
        name: 'Cover 2',
        subtitle: 'Design Option B',
        image: 'https://raw.githubusercontent.com/SoLuutions/Clark-Lindley-Suan/refs/heads/main/attached_assets/cover%20(2).png'
      },
      {
        id: 'Cover 3',
        name: 'Cover 3',
        subtitle: 'Design Option C',
        image: 'https://raw.githubusercontent.com/SoLuutions/Clark-Lindley-Suan/refs/heads/main/attached_assets/cover%20(3).png'
      },
      {
        id: 'Cover 4',
        name: 'Cover 4',
        subtitle: 'Design Option D',
        image: 'https://raw.githubusercontent.com/SoLuutions/Clark-Lindley-Suan/refs/heads/main/attached_assets/cover%20(4).png'
      },
      {
        id: 'Cover 5',
        name: 'Cover 5',
        subtitle: 'Design Option E',
        image: 'https://raw.githubusercontent.com/SoLuutions/Clark-Lindley-Suan/refs/heads/main/attached_assets/cover%20(5).png'
      }
    ];

    function createCoverCard(cover, index) {
      const votedCovers = JSON.parse(localStorage.getItem('votedCovers') || '{}');
      const hasVoted = !!votedCovers[cover.id];
      const userVote = votedCovers[cover.id];

      return `
        <div class="card-animate bg-white rounded-2xl overflow-hidden shadow-sm border border-stone-200/60 hover:shadow-lg transition-shadow duration-300" style="animation-delay: ${index * 0.1}s" data-cover="${cover.id}">
          <div class="relative aspect-[3/4] overflow-hidden bg-stone-100">
            <img src="${cover.image}" alt="${cover.name}" class="w-full h-full object-cover">
            ${hasVoted ? '<div class="absolute top-4 right-4 bg-white/95 backdrop-blur-sm px-3 py-1.5 rounded-full shadow-sm"><span class="text-xs font-medium text-stone-600">Voted ‚úì</span></div>' : ''}
          </div>
          <div class="p-6">
            <h3 class="text-lg font-semibold text-stone-800 mb-1 text-center">${cover.name}</h3>
            <p class="text-sm text-stone-500 mb-5 text-center">${cover.subtitle}</p>
            <div class="flex gap-2">
              <button 
                onclick="vote('${cover.id}', 'up')" 
                ${hasVoted ? 'disabled' : ''}
                class="flex-1 flex flex-col items-center gap-1.5 py-3 px-2 rounded-xl transition-all duration-200 ${hasVoted ? (userVote === 'up' ? 'bg-emerald-600 text-white' : 'bg-stone-100 text-stone-400') : 'bg-emerald-600 hover:bg-emerald-700 text-white'} ${hasVoted ? 'cursor-default' : 'cursor-pointer hover:scale-105'}"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                </svg>
                <span class="text-xs font-medium">Like</span>
                <span class="vote-count text-sm font-bold count-reveal ${hasVoted ? 'revealed' : ''}" data-type="up">0</span>
              </button>
              <button 
                onclick="vote('${cover.id}', 'neutral')" 
                ${hasVoted ? 'disabled' : ''}
                class="flex-1 flex flex-col items-center gap-1.5 py-3 px-2 rounded-xl transition-all duration-200 ${hasVoted ? (userVote === 'neutral' ? 'bg-amber-500 text-white' : 'bg-stone-100 text-stone-400') : 'bg-amber-500 hover:bg-amber-600 text-white'} ${hasVoted ? 'cursor-default' : 'cursor-pointer hover:scale-105'}"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                </svg>
                <span class="text-xs font-medium">Neutral</span>
                <span class="vote-count text-sm font-bold count-reveal ${hasVoted ? 'revealed' : ''}" data-type="neutral">0</span>
              </button>
              <button 
                onclick="vote('${cover.id}', 'down')" 
                ${hasVoted ? 'disabled' : ''}
                class="flex-1 flex flex-col items-center gap-1.5 py-3 px-2 rounded-xl transition-all duration-200 ${hasVoted ? (userVote === 'down' ? 'bg-rose-500 text-white' : 'bg-stone-100 text-stone-400') : 'bg-rose-500 hover:bg-rose-600 text-white'} ${hasVoted ? 'cursor-default' : 'cursor-pointer hover:scale-105'}"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.715.211-1.413.608-2.008L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5"/>
                </svg>
                <span class="text-xs font-medium">Dislike</span>
                <span class="vote-count text-sm font-bold count-reveal ${hasVoted ? 'revealed' : ''}" data-type="down">0</span>
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderCovers() {
      const grid = document.getElementById('coversGrid');
      grid.innerHTML = BOOK_COVERS.map((cover, index) => createCoverCard(cover, index)).join('');
      document.getElementById('loadingState').classList.add('hidden');
      grid.classList.remove('hidden');
    }

    function getVoterId() {
      let voterId = localStorage.getItem('voterId');
      if (!voterId) {
        voterId = 'voter_' + Math.random().toString(36).substring(2, 15) + Date.now().toString(36);
        localStorage.setItem('voterId', voterId);
      }
      return voterId;
    }

    function vote(coverName, voteType) {
      const votedCovers = JSON.parse(localStorage.getItem('votedCovers') || '{}');

      if (votedCovers[coverName]) {
        showNotification('You have already voted for this cover.', 'error');
        return;
      }

      const voterId = getVoterId();
      const callbackName = 'voteCallback' + (++scriptCounter);
      window[callbackName] = () => {
        votedCovers[coverName] = voteType;
        localStorage.setItem('votedCovers', JSON.stringify(votedCovers));
        
        showNotification('Your vote has been recorded!', 'success');
        
        // Re-render the card to show updated state
        renderCovers();
        loadVotes();
      };

      const script = document.createElement('script');
      script.src = `${SCRIPT_URL}?coverName=${encodeURIComponent(coverName)}&voteType=${voteType}&voterId=${encodeURIComponent(voterId)}&callback=${callbackName}`;
      document.body.appendChild(script);
      setTimeout(() => script.remove(), 5000);
    }

    function loadVotes() {
      const callbackName = 'loadCallback' + (++scriptCounter);

      window[callbackName] = function(votes) {
        const votedCovers = JSON.parse(localStorage.getItem('votedCovers') || '{}');
        let totalVotes = 0;
        let uniqueVoters = new Set();

        votes.forEach(vote => {
          const card = document.querySelector(`[data-cover="${vote.name}"]`);
          if (!card) return;

          const upCount = card.querySelector('[data-type="up"]');
          const neutralCount = card.querySelector('[data-type="neutral"]');
          const downCount = card.querySelector('[data-type="down"]');

          if (upCount) upCount.textContent = vote.thumbsUp || 0;
          if (neutralCount) neutralCount.textContent = vote.neutral || 0;
          if (downCount) downCount.textContent = vote.thumbsDown || 0;

          totalVotes += (vote.thumbsUp || 0) + (vote.neutral || 0) + (vote.thumbsDown || 0);

          // Collect unique voters if available
          if (vote.voters && Array.isArray(vote.voters)) {
            vote.voters.forEach(v => uniqueVoters.add(v));
          }

          if (votedCovers[vote.name]) {
            card.querySelectorAll('.vote-count').forEach(c => c.classList.add('revealed'));
          }
        });

        document.getElementById('totalVotes').textContent = totalVotes;
        // Use unique voters count if available, otherwise estimate
        const voterCount = uniqueVoters.size > 0 ? uniqueVoters.size : Object.keys(votedCovers).length;
        document.getElementById('totalVoters').textContent = voterCount || Math.max(1, Math.floor(totalVotes / 3));
      };

      const script = document.createElement('script');
      script.src = `${SCRIPT_URL}?callback=${callbackName}`;
      document.body.appendChild(script);
      setTimeout(() => script.remove(), 5000);
    }

    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      const isError = type === 'error';
      
      notification.innerHTML = `
        <div class="flex items-center gap-3 px-5 py-4 rounded-xl shadow-lg backdrop-blur-sm ${isError ? 'bg-rose-50 border border-rose-200 text-rose-800' : 'bg-emerald-50 border border-emerald-200 text-emerald-800'}">
          ${isError ? 
            '<svg class="w-5 h-5 text-rose-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>' :
            '<svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
          }
          <span class="font-medium text-sm">${message}</span>
          <button onclick="hideNotification()" class="ml-2 p-1 rounded-full hover:bg-black/5 transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      `;
      
      notification.classList.remove('hidden');
      notification.classList.add('notification-show');
      
      setTimeout(() => hideNotification(), 3000);
    }

    function hideNotification() {
      const notification = document.getElementById('notification');
      notification.classList.remove('notification-show');
      notification.classList.add('notification-hide');
      setTimeout(() => {
        notification.classList.add('hidden');
        notification.classList.remove('notification-hide');
      }, 300);
    }

    window.addEventListener('load', () => {
      renderCovers();
      loadVotes();
    });
  </script>
</body>
</html>
